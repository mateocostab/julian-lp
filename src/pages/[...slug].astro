---
/**
 * Catch-all route for Storyblok visual editor.
 * Fetches the story based on the URL slug so Storyblok's preview works.
 */
import Layout from '../layouts/Layout.astro';
import { useStoryblokApi } from '@storyblok/astro';
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro';

// Fallback imports
import Hero from '../components/Hero.astro';
import MetricsBar from '../components/MetricsBar.astro';
import Problem from '../components/Problem.astro';
import Modules from '../components/Modules.astro';
import Speaker from '../components/Speaker.astro';
import CalendlySection from '../components/CalendlySection.astro';
import FAQ from '../components/FAQ.astro';
import Footer from '../components/Footer.astro';
import StickyCTA from '../components/StickyCTA.astro';

let story: any = null;
const slug = Astro.params.slug || 'home';

try {
  const storyblokApi = useStoryblokApi();
  const { data } = await storyblokApi.get(`cdn/stories/${slug}`, {
    version: 'draft',
    cv: Date.now(),
  });
  story = data.story;
} catch (e) {
  // Storyblok unavailable — use fallback
}
---

<Layout
  title="MasterClass: El Sistema de $1.5M USD para Dominar Fechas Promocionales — Julián Mora"
  description="MasterClass exclusiva con Julián Mora, CMO de Lummia. Aprende el sistema exacto con el que facturó $1.5M USD en el último Black Friday con un ROAS de 14.5x. Solo 10 cupos."
>
  {story ? (
    <StoryblokComponent blok={story.content} />
  ) : (
    <main id="main-content">
      <Hero />
      <MetricsBar />
      <Problem />
      <Modules />
      <Speaker />
      <CalendlySection />
      <FAQ />
      <Footer />
      <StickyCTA />
    </main>
  )}
</Layout>
